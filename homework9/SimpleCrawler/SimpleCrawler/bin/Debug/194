<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="never" />
    <meta property="og:description" content="面向C开发的前端工程，当功能稳定之后，就需要持续优化打开速度，达到3.5秒以内的首页打开时间、1.5秒以内的首屏渲染时间。" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>前端工程打开速度优化的循序渐进总结 - 旁观者 - 博客园</title>
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=BKtyzabbeYJEVOaELkxmRjHbp7LT-v37GzrU5S24bJk" />
    <link id="MainCss" rel="stylesheet" href="/skins/webload/bundle-webload.min.css?v=ruvm6IrJzXJObi2uPQfuATPd1yK_KwQgdDOW0ibFF64" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/webload/bundle-webload-mobile.min.css?v=ADiCwO2hOTdd5yYidcx7eob7ix2VJI4o_TXjEycTHjs" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/zhengyun_ustc/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/zhengyun_ustc/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/zhengyun_ustc/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=wKnarAbt-YO5waLYR80IqCLKpzPpF-s-32JKmKCtJxg"></script>
    <script>
        var currentBlogId = 10850;
        var currentBlogApp = 'zhengyun_ustc';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var skinName = 'WebLoad';
    </script>
    
    
    
</head>
<body>
    <a name="top"></a>
    
    <div id="home">
    <div id="header">
        <div id="blogTitle">
            
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/zhengyun_ustc/">旁观者-郑昀</a>
</div>
<div class="subtitle">
参与软件开发这些年来，不断地遇到新领域新知识点，屡屡感受到新进入者的迷惑和彷徨，所以对遇到的每一个问题都详细记录问题现象、解决思路以及解决方案，并在blog中留下印迹，以备他日有心人google之而知之。<br/>
你们的新手之痛，你们的新业务发展之初的思路混沌，我都感同身受，所以欢迎和我一起探讨，知无不言言无不尽。
</div>

        </div>
        <div id="navigator">
            
<ul id="navList">
    <li id="nav_sitehome">
</li>
    <li id="nav_myhome">

</li>
    <li id="nav_newpost">


</li>
    <li id="nav_contact">
</li>
    <li id="nav_rss">
<a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/zhengyun_ustc/rss/">
订阅</a></li>
    <li id="nav_admin">
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>

            <div class="blogStats">
                
<span id="stats_post_count">随笔 - 
647&nbsp;</span>
<span id="stats_article_count">文章 - 
0&nbsp;</span>
<!-- <span id="stats-comment_count"></span> -->
<span id="stats_comment_count">评论 - 
1149</span>
            </div>
        </div>
    </div>
    <div id="main">
        <div id="mainContent">
            <div class="forFlow">
                <div id="post_detail">
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/zhengyun_ustc/archive/2013/05/09/frontendoptimize.html">前端工程打开速度优化的循序渐进总结</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                
<div id="cnblogs_post_body" class="blogpost-body ">
    <div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">创建人：<a href="http://weibo.com/yunzheng" target="_blank">@郑昀</a></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">更新日期：2013年5月8日 分类: <a href="http://www.cnblogs.com/zhengyun_ustc/category/398069.html">前端技术</a></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong><span style="color: #a52a2a; font-size: large;">优化的重要指标：</span></strong></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<ul>
<li><span style="text-decoration: underline;">页面打开速度</span>（Fully Loaded）</li>
<ul>
<li>网站首页（或列表页）之 First View ：打开速度应在 3秒+0.5秒 内；</li>
<li>对 Repeat View 时的各项指标暂不作要求；</li>
</ul>
<li><span style="text-decoration: underline;">首屏打开时间</span>（Start Render）</li>
<ul>
<li>网站首页（或列表页） 之 First View&nbsp;：首屏渲染速度应在 1秒+0.5秒 内；</li>
</ul>
<li><span style="text-decoration: underline;">文档解析完毕时间</span>（Document Complete）：</li>
<ul>
<li>对此指标暂不作要求。</li>
</ul>
</ul>
</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">指标测试方法参考附录A。</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><span style="font-size: large;"><strong>提纲：</strong></span></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><ol>
<li>遵循常规优化建议</li>
<li>外联内联js/css的位置摆放建议</li>
<li>combo handler的引入</li>
<li>图片无损压缩的优化</li>
<li>减少 dom elements 的数量</li>
<li>引入 textarea/script 元素做延迟解析异步渲染</li>
</ol></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><hr /></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong><span style="color: #0000ff; font-size: large;">优化第一阶段：遵循常规优化建议</span></strong></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">本阶段所使用工具参考附录B。</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">常规优化建议：</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><ol>
<li><strong><span style="color: #ff0000;">javascript 外联文件引用放在 html 文档底部</span></strong>：具体如何摆放内联JS/CSS和外联JS/CSS，请参考 优化第二阶段；</li>
<li><span style="color: #ff0000;"><strong>css 外联文件引用在 html 文档头部</strong></span>：位于 header 内；</li>
<li><span style="color: #ff0000;"><strong>http 静态资源尽量用多个子域名</strong></span>：充分利用现代浏览器的多线程并发下载能力。浏览器的多线程下载能力，参考 附录C；</li>
<ul>
<li>具体建议：</li>
<ul>
<li>JS、CSS、CSS背景图片、CSSSprite图片分散在 s0～s2.55tuanimg.com 下；</li>
<li>业务类图片分散在 p0～p3.55tuanimg.com 下；</li>
</ul>
</ul>
<li>服务器端提供 html 文档和 http 静态资源时，<span style="color: #ff0000;"><strong>尽量开启 gzip 压缩</strong></span>；</li>
<ul>
<li>json/xml 等格式的文本响应，也建议开启 gzip ；</li>
<li>jepg/png 等图片，可以选择不开启 gzip，因为可能服务器端图片无损压缩算法已经很强悍了，不需要依赖于 gzip；</li>
</ul>
<li>在 js、css、image 等资源响应的 http headers 里，<span style="color: #ff0000;"><strong>设置 expires、last-modified</strong></span>；</li>
<ul>
<li>含义参考 附录D；</li>
<li><a href="http://www.cnblogs.com/zhengyun_ustc/" target="_blank">郑昀</a>实例示范：</li>
<li>Nginx设置示范：</li>
<ul>
<li>
<table class="ynote_table" style="border-width: 1px; border-style: solid; border-color: #999999; border-image: initial; border-collapse: collapse; margin: 6px auto;" border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td style="word-break: break-all; border-image: initial; border-width: 1px; border-color: #999999; border-style: solid;" valign="top">
<div>
<p><span style="font-family: Verdana, sans-serif; color: red; font-size: 12px;" lang="EN-US">location ~ .*\.(js|css)$</span><span style="color: red; font-family: Verdana, sans-serif; font-size: 12px;">{</span></p>
<p><span style="font-family: Verdana, sans-serif; color: red; font-size: 12px;" lang="EN-US">expires 30d;</span></p>
<p><span style="font-family: Verdana, sans-serif; color: red; font-size: 12px;" lang="EN-US">}</span></p>
<p><span style="font-family: Verdana, sans-serif; color: red; font-size: 12px;" lang="EN-US">location ~ .*\.(gif|jpg|jpeg|png|bmp)$</span><span style="color: red; font-family: Verdana, sans-serif; font-size: 12px;">{</span></p>
<p><span style="font-family: Verdana, sans-serif; color: red; font-size: 12px;" lang="EN-US">expires 1M;</span></p>
<p><span style="font-family: Verdana, sans-serif; color: red; font-size: 12px;" lang="EN-US">}</span></p>
</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
</ul>
<li><span style="color: #ff0000;"><strong>尽量减少 HTTP Requests 的数量</strong></span>；</li>
<ul>
<li>通过 combo handler 合并 js 和 css 的下载，参考 优化第三阶段；</li>
<li>本阶段请尽量减少外联 js/css 文件数，尽量减少 ajax 调用；</li>
</ul>
<li><span style="color: #ff0000;"><strong>js/css 的 minify</strong></span>：可统一通过 combo handler 做到压缩加合并；</li>
<li><span style="color: #ff0000;"><strong>减少不必要的 301/302 跳转</strong></span>：别让页面打开时间浪费在302多次跳转上（每次可能几十毫秒）；</li>
<li>请<span style="color: #ff0000;"><strong>大量使用 CSS Sprites</strong></span>：这样做可以大大地减少CSS背景图片的HTTP请求次数；</li>
<li><span style="color: #ff0000;"><strong>首屏不需要展示的较大尺寸图片，请使用 LazyLoad</strong></span><span class="Apple-converted-space">&nbsp;</span>；</li>
<li><span style="color: #ff0000;"><strong>避免404错误</strong></span>：请求一个外联 js 失败时获得的404错误，不但会堵塞并行的下载，而且浏览器会尝试分析404响应的内容，来辨识它是否是有用的Javascript代码；</li>
<li><span style="color: #ff0000;"><strong>减少 cookies 的大小</strong></span>：尽量减少 cookies 的体积对减少用户获得响应的时间十分重要；</li>
<ul>
<li>去除不必要的 cookie&nbsp;；</li>
<li>尽量减少 cookie 的大小；</li>
<li>留心将 cookie 设置在适当的域名下，避免影响到其他网站；</li>
<li>设置适当的过期时间。一个较早的过期时间或者不设置过期时间会更快地删除 cookie，从而减少响应时间。</li>
</ul>
<li><span style="color: #ff0000;"><strong>使用无 cookies 的域</strong></span>：</li>
<ul>
<li>当浏览其请求一个静态图片并一同发送 cookie 时，服务器并不需要这些 cookies 。这样只是毫无益处地创建了多余的网络流量。应当保证静态资源在请求时没有携带 cookies，所以需要把你的静态资源放在另一个子域名下。</li>
<li>如果你的域名是 www.example.org，你可以将你的静态资源放在 static.example.org 中。如果你把 cookie 设置在顶级域名 example.org 上而不是 www.example.org，那么所有发送至 static.example.org 的请求会包括那些 cookies。在 这种情况下，你可以用一个全新的没有 cookie 的域名来放置你的静态资源。</li>
</ul>
<li><span style="color: #ff0000;"><strong>避免使用 javascript 来定位布局</strong></span>；</li>
</ol></div>
<hr style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;" />
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong><span style="color: #0000ff; font-size: large;">优化第二阶段：外联内联js/css的位置摆放建议</span></strong></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">玉伯定义的加载和阻塞三定律如下：
<div>
<ul>
<li><strong>定律一：资源是否下载依赖 JS 执行结果&mdash;&mdash;</strong><strong>JS 有可能会修改 DOM。</strong>典型的，可能会有&nbsp;<code>document.write</code>。这意味着，在当前 JS 加载和执行完成前，后续所有资源的下载有可能是没必要的。这是 JS 阻塞后续资源下载的根本原因。</li>
<li><strong>定律二：JS 执行依赖 CSS 最新渲染&mdash;&mdash;</strong><strong>JS 的执行有可能依赖最新样式。</strong>比如，可能会有&nbsp;<code>var width = $('#id').width()</code>. 这意味着，JS 代码在执行前，浏览器必须保证在此 JS 之前的所有 css（无论外链还是内嵌）都已下载和解析完成。这是 CSS 阻塞后续 JS 执行的根本原因。</li>
<li><strong>定律三：现代浏览器存在 prefetch 优化&mdash;&mdash;</strong><span class="Apple-converted-space">&nbsp;</span>现代浏览器在竞争中，在 UI update 线程之外，还会开启另一个线程，对后续 JS 和 CSS 提前下载（注意，仅提前下载，并不执行）。有了 prefetch 优化，这意味着，在不存在任何阻塞的情况下，理论上 JS 和 CSS 的下载时机都非常优先，和位置无关。</li>
</ul>
<div>根据三定律，<a href="http://www.cnblogs.com/zhengyun_ustc/" target="_blank">郑昀</a>认为：</div>
</div>
</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<p><span style="font-family: 'Microsoft Yahei';">一，如果真的需要把外联<span lang="EN-US">js</span>和<span lang="EN-US">css</span>放在<span lang="EN-US">head</span>里，那也需要从下面这种排序</span></p>
<p><span style="font-family: 'Microsoft Yahei';"><span lang="EN-US">1.<span style="font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>外联<span lang="EN-US">js</span></span></p>
<p><span style="font-family: 'Microsoft Yahei';"><strong><span lang="EN-US">2.<span style="font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></strong><strong>外联<span lang="EN-US">css</span></strong></span></p>
<p><span style="font-family: 'Microsoft Yahei';"><span lang="EN-US">3.<span style="font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>外联<span lang="EN-US">js</span></span></p>
<p><span style="font-family: 'Microsoft Yahei';">统一为：</span></p>
<p><span style="font-family: 'Microsoft Yahei';"><strong><span lang="EN-US">1.<span style="font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></strong><strong>外联<span lang="EN-US">css</span></strong></span></p>
<p><span style="font-family: 'Microsoft Yahei';"><span lang="EN-US">2.<span style="font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>外联<span lang="EN-US">js</span></span></p>
<p><span style="font-family: 'Microsoft Yahei';"><span lang="EN-US">3.<span style="font: normal normal normal 7pt/normal 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>外联<span lang="EN-US">js</span></span></p>
<p><span style="font-family: 'Microsoft Yahei';"><strong><span style="color: red;">不要</span><span style="color: red;" lang="EN-US">script</span></strong><strong><span style="color: red;">和</span><span style="color: red;" lang="EN-US">css</span></strong><strong><span style="color: red;">交替混编。</span></strong></span></p>
<p><span lang="EN-US"><span style="font-family: 'Microsoft Yahei';">&nbsp;</span></span></p>
<p><span style="font-family: 'Microsoft Yahei';">原因是，据</span><span style="font-family: 'Microsoft Yahei';">有人称：『</span></p>
<p><span style="font-family: 'Microsoft Yahei';">从<span lang="EN-US">Firefox 4+</span>开始，对<span lang="EN-US">prefetch</span>的策略有些许调整，调整在于<span lang="EN-US">&nbsp;head&nbsp;</span>中<span lang="EN-US">&nbsp;css&nbsp;</span>与<span lang="EN-US">&nbsp;js&nbsp;</span>的位置。</span></p>
<p><span style="font-family: 'Microsoft Yahei';"><span lang="EN-US">css&nbsp;</span>在外联&nbsp;<span lang="EN-US">js&nbsp;</span>后面时，可能会在&nbsp;<span lang="EN-US">script&nbsp;</span>后面的&nbsp;<span lang="EN-US">css&nbsp;</span>加载好之前，提前进行首次渲染。</span></p>
<p><span style="font-family: 'Microsoft Yahei';">然后等后面的&nbsp;<span lang="EN-US">css&nbsp;</span>加载好后，再次更新&nbsp;<span lang="EN-US">Render Tree&nbsp;</span>并进行渲染，造成页面闪烁现象。</span></p>
<p><span style="font-family: 'Microsoft Yahei';">即，各种优化策略，似乎随着浏览器版本不同，头可能发生细微差异。</span></p>
<p><span style="font-family: 'Microsoft Yahei';">』</span></p>
<p><span style="font-family: 'Microsoft Yahei';"><strong>所以<a href="http://www.cnblogs.com/zhengyun_ustc/" target="_blank">郑昀</a>认为，保守做法是，<span lang="EN-US">js&nbsp;</span></strong><strong>和&nbsp;<span lang="EN-US">css&nbsp;</span></strong><strong>不要在&nbsp;<span lang="EN-US">head&nbsp;</span></strong><strong>里交替混编，统一为先外联<span lang="EN-US">css</span></strong><strong>再外联<span lang="EN-US">js</span></strong><strong>！</strong></span></p>
<p><span style="font-family: 'Microsoft Yahei';"><strong>&nbsp;</strong></span></p>
<p><span style="font-family: 'Microsoft Yahei';">二，但只有万不得已时，才会在 head 里放外联js，否则请把外联</span><span style="font-family: 'Microsoft Yahei';" lang="EN-US">js</span><span style="font-family: 'Microsoft Yahei';">放置到</span><span style="font-family: 'Microsoft Yahei';" lang="EN-US">&lt;/body&gt;</span><span style="font-family: 'Microsoft Yahei';">前。</span></p>
<p><span style="font-family: 'Microsoft Yahei';">原因是张克军的《<a style="cursor: pointer;" href="http://hikejun.com/blog/2012/02/02/js%E5%92%8Ccss%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%85%B3%E7%B3%BB/">js和css的顺序关系</a>》指出：</span></p>
<div><span style="font-family: 'Microsoft Yahei';">&nbsp; &nbsp; 只要 head 里出现外联js，无论如何放，css文件都不能和body里的请求并行。</span></div>
<div><span style="font-family: 'Microsoft Yahei';">&nbsp; &nbsp;&nbsp;<span style="color: #ff0000;">body 里 dom 渲染取决于 head 里的js执行完</span>。</span></div>
<p>外联js放在页面最后，高级浏览器会自动做优化（prefetch），你不用担心，它也可能会提前下载。</p>
<p>&nbsp;</p>
<hr />
<div>&nbsp;</div>
<div><strong><span style="color: #0000ff; font-size: large;">优化第三阶段：combo handler 的引入</span></strong></div>
<div><strong><span style="font-family: 'Microsoft Yahei'; font-size: medium;">背景</span></strong></div>
<div><span style="font-family: 'Microsoft Yahei';">Combo Handler 是 Yahoo! 开发的一个 Apache 模块，它实现了开发人员简单方便地通过URL来合并JavaScript和CSS文件，从而大大减少文件请求数。</span></div>
<div><strong><span style="font-family: 'Microsoft Yahei'; font-size: medium;">目的</span></strong></div>
<div><span style="font-family: 'Microsoft Yahei';">它满足 Yahoo! 前端优化第一条原则：Minimize HTTP Requests，来减少三路握手和HTTP请求的发送次数。</span></div>
<div><strong><span style="font-family: 'Microsoft Yahei'; font-size: medium;">国内实例</span></strong></div>
<div>
<div><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">淘宝网首页meta里多个js合并的声明：</span></div>
<div>
<pre><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">&lt;<span class="start-tag">script</span> <span class="attribute-name">src</span>="<a class="attribute-value" style="cursor: pointer;" href="view-source:http://a.tbcdn.cn/??s/kissy/1.2.0/kissy-min.js,p/global/1.0/global-min.js,p/fp/2012/core.js,p/fp/2012/fp/module.js,p/fp/2012/fp/util.js,p/fp/2012/fp/directpromo.js?t=2012062320120712.js">http://a.tbcdn.cn/??s/kissy/1.2.0/<span style="color: #ff0000;">kissy-min.js,</span>p/global/1.0/global-min.js,p/fp/2012/<span style="color: #ff0000;">core.js,</span>p/fp/2012/fp/<span style="color: #ff0000;">module.js,</span>p/fp/2012/fp/<span style="color: #ff0000;">util.js,</span>p/fp/2012/fp/directpromo.js?t=2012062320120712.js</a>" <span class="attribute-name">data-fp-timestamp</span>="<a class="attribute-value">20120703</a>"&gt;&lt;/<span class="end-tag">script</span>&gt;</span></pre>
<pre><span style="font-size: 14px;"><span style="font-family: 'Microsoft Yahei';">js之间用英文逗号或&amp;符号分隔。</span><span style="font-family: 'Microsoft Yahei';">此src的Response是多个js文件的内容拼装。</span></span></pre>
<pre><strong style="font-family: 微软雅黑;"><span style="font-family: 'Microsoft Yahei'; font-size: medium;">国内的 Combo Script 支持</span></strong></pre>
<pre><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">淘宝李晶-拔赤在 <a style="cursor: pointer;">https://github.com/jayli/combo</a> 下发布了combo.php和minfy.php，能够做到合并文件(不压缩)，以及合并且压缩。</span></pre>
<pre><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">文件列表：
 - combo.php 合并文件，不压缩
 - minify.php 合并压缩文件
 - cssmin.php 压缩css
 - jsmin.php 压缩js
 - cb.php 淘宝CDN合并文件策略的模拟</span></pre>
<pre><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">脚本使用:
 - 要求php5及以上版本
 - 程序在找不到本地文件的情况下，会去指定的cdn上找同名文件
 - 程序会自动转义-min文件为源文件，因此要约定-min文件和原文件要成对出现
 - 需要定义combo.php和minify.php中的$YOUR_CDN变量
 - 如果只是合并压缩local文件，则不必重置$YOUR_CDN变量
 - 这里提供cb.php，用来实现tbcdn的开发环境的模拟,apache的配置在cb.php中</span></pre>
<pre><strong style="font-family: 微软雅黑;"><span style="font-family: 'Microsoft Yahei'; font-size: medium;">CDN上的 Combo Handler支持</span></strong></pre>
<pre><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">1）<a style="cursor: pointer;" href="http://www.yuiblog.com/blog/2008/07/16/combohandler/">2008年7月YUI Team宣布在YAHOO! CDN上对YUI JavaScript组件提供Combo Handler服务</a>。</span></pre>
<pre><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">2）淘宝CDN支持Combo Handler，用逗号分隔js/css，用两个问号来触发combo特性：</span></pre>
<div id="LC21" class="line"><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">&nbsp;- http://a.tbcdn.cn/??1.js,2.js</span></div>
<div id="LC22" class="line"><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">&nbsp;- http://a.tbcdn.cn/subdir/??1/js,2.js</span></div>
<div id="LC22" class="line"><span style="font-family: 'Microsoft Yahei'; font-size: 14px;">用一个问号来添加时间戳，如：</span></div>
<div id="LC22" class="line"><span style="font-family: 'Microsoft Yahei'; font-size: 14px;"> - http://a.tbcdn.cn/??fp/directpromo.js?t=2012062320120712</span></div>
</div>
</div>
&nbsp;
<div>为了避免 CDN 缓存错误的版本，combo上线的访问策略是：</div>
<div>
<div>1）静态文件传到服务器端；</div>
<div>2）部署人员使用线上静态文件服务器的IP地址直接请求combo服务，挨个儿combo请求一次；</div>
<div>3）部署人员确认上面的请求都成功、内容无误后，再换成CDN地址再次请求，确保CDN缓存正确的文件内容。</div>
</div>
<div>&nbsp;</div>
</div>
<hr style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;" />
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong><span style="color: #0000ff; font-size: large;">优化第四阶段：图片无损压缩的优化</span></strong></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div>页面上的各种图片是否有优化的余地，推荐使用<span class="Apple-converted-space">&nbsp;</span><a style="cursor: pointer;" href="https://developers.google.com/speed/pagespeed/insights">PageSpeed</a><span class="Apple-converted-space">&nbsp;</span>检测一下。</div>
<div>下面的建议来自于冯凯。</div>
<div>由于专卖店等各种业务上传的图片有 jpeg、png 和 gif 等格式，因此三种格式都需要优化：</div>
<div>1）jpegtran和jpegoptim的压缩效果几乎完全相同。</div>
<div>但jpegtran有progressive编码（渐进式的展示，先显示模糊的，再逐步清晰），而且通常（84%的概率）对于大图片（10k+）压缩比更高。</div>
<div>虽然我们的大部分页面已经改成延迟加载了，但对于非延迟加载的页面，效果明显更好。</div>
<div>经测试，pagespeed 并没有按照 progressive 方式提供建议。</div>
<div>&nbsp;</div>
<div>2）测试了png的几种压缩方式，压缩效果各异。测试的一张图片 optipng 只压缩了约5%，但其他几种达到了20%+</div>
<div>经测试，pagespeed上给出的可压缩比例是按照optipng给出的。</div>
<div>pngout据说采用了不同的编码，因此对小图片压缩效果更好。用imageoptim测试确实略优，但命令行上还没找到合适的调用参数。</div>
<div>目前决定采用pngcrush。</div>
<div>对于采用png8，以大幅压缩的方法，我们不做技术处理。</div>
<div>&nbsp;</div>
<div>3）gif就采用gifsicle做压缩。</div>
<div>大部分情况下，我们不建议采用gif图片。对于单帧gif更应该用png格式替代。</div>
<div>这里我们暂不考虑通过技术处理来吧单帧gif转换成png。</div>
<div>&nbsp;</div>
<div>4）采用php的exec调用shell脚本的方式来执行这些bin文件。</div>
</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">参考资料：</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div>
<ul>
<li><a style="cursor: pointer;" href="http://www.slideshare.net/stoyan/image-optimization-for-the-web-at-phpworks-presentation">stoyan，image-optimization-for-the-web-at-phpworks-presentation</a>，幻灯片；</li>
<li><a style="cursor: pointer;" href="http://hi.baidu.com/thinkinginlamp/item/fe313017a77ba90fb98a1acb">老王，优化图片</a>，2009；</li>
</ul>
</div>
</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><hr />
<div>&nbsp;</div>
<div><strong><span style="color: #0000ff; font-size: large;">优化第五阶段：减少 DOM Elements 的数量</span></strong></div>
<div>
<div>据<a style="cursor: pointer;" href="http://lifesinger.wordpress.com/2011/09/23/bigrender-for-taobao-item/">玉伯说</a>，对于典型的淘宝商品详情页，经测试发现，<span style="color: #ff0000;"><strong>每增加一个 DOM 节点，会导致首屏渲染时间延迟约 0.5ms</strong></span>。</div>
</div>
</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div>2011年时，我们首页一个商品节点包含了<strong>21</strong>个DOM节点，充满了大量的em、strong、span。</div>
</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div><span class="nodeBracket editable insertBefore ">所以前端开发部门必须与产品部交互设计人员积极沟通，而不仅仅</span>是在她们提供的交互设计稿件上切图，必须在简化视觉元素和精简DOM节点上表达自己的意见。</div>
</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">2012年，简化设计后，首页一个商品节点包含<strong>13</strong>个节点。</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div><hr />
<div>&nbsp;</div>
<div><strong><span style="color: #0000ff; font-size: large;">优化第六阶段：引入 textarea/script 元素做延迟解析异步渲染</span></strong></div>
<div>
<div><strong><span style="font-size: medium;">textarea 延迟渲染原理</span></strong></div>
</div>
</div>
<div>
<div>据<a style="cursor: pointer;" href="http://lifesinger.wordpress.com/2011/09/23/bigrender-for-taobao-item/">玉伯介绍</a>，HTML 元素中有一种 RCDATA elements，含 textarea 和 title 。</div>
<div>RCDATA指的是，Replaceable Character Data。</div>
<div>如果用隐藏的 textarea 来存放 html 代码，textarea 中的内容会按照 RCDATA 规则来解析：</div>
<div><ol>
<li>遇到 &amp; 时，会尽可能得到实体字符。</li>
<li>遇到 &lt;/textarea(\s|\\|&gt;) 时，会结束解析。</li>
<li>其他都直接作为 textarea 的内容。</li>
</ol>
<div><img class="decoded" src="https://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard03.png" alt="http://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard03.png" /></div>
</div>
<div>获取也非常简单：</div>
<div><img class="decoded" src="https://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard04.png" alt="http://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard04.png" /></div>
<div>据<a style="cursor: pointer;" href="http://yiminghe.iteye.com/blog/654487">yiminghe介绍</a>，<span style="color: #ff0000;">对于屏幕外延迟渲染的 html 存放在隐藏(visibility:hidden)的 textarea 中，并且该 textarea 占据本该渲染的位置，监控窗体滚动，当textarea进入可见区域，将该 textarea 内的 value， 插入到 textarea 之前，并删除掉 textarea&nbsp;</span>。</div>
<div>&nbsp;</div>
<div>这样，把大量不需要在首屏展示的html代码分模块放入一个一个的 textarea 里，<strong>大大减少了DOM节点数</strong>，从而给浏览器合理的喘息（UI Update）时间，<strong>等首屏真正在显示器上绘制出来后</strong>，再得到 textarea.value ，填充回 DOM Tree。</div>
<div>&nbsp;</div>
<div>textarea+datalazyload，相对于其他延迟加载异步渲染解决方案，最大好处，还是减少首屏绘制时的DOM节点总数。</div>
<div>&nbsp;</div>
<div><strong>参考资料：</strong></div>
<div>
<ul>
<li>玉伯（王保平，id@lifesinger）《<a style="cursor: pointer;" href="http://lifesinger.wordpress.com/2011/09/23/bigrender-for-taobao-item/">淘宝详情页的 BigRender 优化与存放大块 HTML 内容的最佳方式</a>》（需翻墙）</li>
<li>BigRender所依赖的<a style="cursor: pointer;" href="https://github.com/kissyteam/kissy/blob/master/src/datalazyload/src/datalazyload.js">&ldquo;数据延迟加载组件&rdquo;datalazyload</a></li>
<li>yiminghe《<a style="cursor: pointer;" href="http://yiminghe.iteye.com/blog/654487">数据延迟加载组件</a>》</li>
</ul>
</div>
</div>
<div>
<div><strong><span style="font-size: medium;">script 延迟渲染原理</span></strong>&nbsp;<span style="color: #ff0000; font-size: large;"><strong><br /></strong></span>
<div>玉伯在《<a style="cursor: pointer;" href="http://lifesinger.wordpress.com/2011/09/23/bigrender-for-taobao-item/">淘宝详情页的 BigRender 优化与存放大块 HTML 内容的最佳方式</a>》中提到，</div>
<div>与前面说的 textarea 存放 html 代码一样，你也可以用 script 来存放，目的都是减少 DOM 节点数。</div>
<div>浏览器在拿到 html 代码时，首次 Tokenization &mdash; Tree Construction 的速度就会大大加快。</div>
<div><img class="decoded" src="https://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard026.png" alt="http://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard026.png" /></div>
<div>&nbsp;</div>
<div><strong><span style="font-size: medium;">某网是怎么实践的</span></strong></div>
<div>
<div>在某网商品详情页上，HTML 文档底部遍布着这样的代码：</div>






</div>
<div><img class="decoded" src="https://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard027.png" alt="http://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard027.png" /></div>






</div>






</div>






</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div><strong>注意这些 script 的 type 是 text/x-template ，</strong>这是YUI类库自己定义的元素type。</div>
<div>你可以注意到，LABjs 也玩过这个小技巧，也是自己定义了一个元素 type&ldquo;text/cache&rdquo;， 由于浏览器不认识这种 type，就会主动忽略这个 HTML元素。</div>
<div>&nbsp;</div>
<div><strong><span style="font-size: medium;">什么时候取出这些隐藏HTML代码呢？</span></strong></div>
<div>那就要用到这些 script 的 id 了。</div>
<div><a style="cursor: pointer;" href="http://yuilibrary.com/yui/docs/app/app-todo.html">YUI的教程上</a>是这么获得 HTML 代码：</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000ff;">template: Y.one('#todo-item-template').<strong>getHTML</strong>(),</span></div>
<div>某网的做法是：</div>
<div>比如id=<a class="attribute-value">search-path-markup的script，</a></div>
<div><a class="attribute-value">也是用Y.one来拿：</a></div>
<div><img class="decoded" src="https://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard028.png" alt="http://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard028.png" /></div>
<div><a class="attribute-value">然后用_6e.getContent()方法：</a></div>
<div><img class="decoded" src="https://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard029.png" alt="http://images.cnblogs.com/cnblogs_com/zhengyun_ustc/255879/o_clipboard029.png" /></div>
<div>某网由于走的是 YUI3.0 体系，所以可以利用 script 存放html代码技巧，让商品详情页首屏更快地渲染出来。</div>






</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong><span style="font-size: medium;">我们的实践</span></strong></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">在商品详情页上，我们把很多不需要首屏渲染的 html 代码放入了类似于</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><span style="color: #0000ff;">&lt;textarea id="goodsAll_info" &nbsp;style="display:none;"&gt;&lt;/textarea&gt;</span></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">的隐藏 textarea 里了。</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">然后在 html 文档底部，放内联 js 来读取：</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div><span style="color: #0000ff;">&lt;script type="text/javascript"&gt;</span></div>
<div><span style="color: #0000ff;">$(function(){</span></div>
<div><span style="color: #0000ff;">var area = document.getElementById("goodsAll_info").value;</span></div>
<div><span style="color: #0000ff;">document.getElementById("goodsAll_info_div").innerHTML = area;</span></div>
<div><span style="color: #0000ff;">});</span></div>
<div><span style="color: #0000ff;">&lt;/script&gt;&nbsp;</span></div>






</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong>&nbsp;</strong></div>
<hr style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;" />
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong><span style="color: #800000; font-size: medium;">附录A：页面打开速度和首屏打开时间的测量</span></strong></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">推荐工具：</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><ol>
<li>推荐使用&nbsp;<a style="cursor: pointer;" href="http://www.webpagetest.org/">http://www.webpagetest.org/</a>&nbsp;评测，由于它受限于并发测试和带宽，所以资源下载速度较差，只能作为与竞争对手对比测试的依据；</li>
<ul>
<li>Test Location 请选择亚洲的中国江苏节点；</li>
<li>Browser 请选择 Firefox、IE9、Chrome等现代浏览器；</li>
<li>如下图所示：</li>
<li><a href="http://www.cnblogs.com/zhengyun_ustc/" target="_blank">郑昀</a></li>






</ul>
<li>运维部的每周博睿检测数据报告，<strong>我们以博睿的数据为准</strong>；</li>
<ul>
<li>博睿从它的各地监测节点以及不同电信链路访问，得到一个响应速度的平均值；</li>






</ul>
<li>Google PageSpeed&nbsp;<a style="cursor: pointer;" href="https://developers.google.com/speed/pagespeed/insights">https://developers.google.com/speed/pagespeed/insights</a>&nbsp;的 Critical Path Explorer；</li>






</ol></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><strong><span style="color: #800000; font-size: medium;">附录B：能提出常规优化建议的工具</span></strong></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">推荐工具：</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><ol>
<li>Firefox插件 YSlow! ；</li>
<li>Google PageSpeed&nbsp;<a style="cursor: pointer;" href="https://developers.google.com/speed/pagespeed/insights">https://developers.google.com/speed/pagespeed/insights</a>&nbsp;；</li>






</ol></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div><strong><span style="color: #800000; font-size: medium;">附录C：浏览器多线程下载能力一览</span></strong></div>
<div>参考怪飞的文章《<a style="cursor: pointer;" href="http://www.planabc.net/2010/05/07/connections_per_server_supported_by_current_browsers/">各浏览器的并行连接数（同域名）</a>&nbsp;》：</div>
<div>
<table style="margin-top: 10px; margin-right: 0px; margin-bottom: 10px; margin-left: 30px;" border="0" cellspacing="6" cellpadding="4">
<tbody>
<tr>
<td style="word-break: break-all;"><span style="text-decoration: underline; font-size: 14px;">Browser</span></td>
<td style="word-break: break-all;"><span style="text-decoration: underline; font-size: 14px;">HTTP/1.1</span></td>
<td style="word-break: break-all;"><span style="text-decoration: underline; font-size: 14px;">HTTP/1.0</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">IE 6,7</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">2</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">4</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">IE 8</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">6</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">6</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">Firefox 3+</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">6</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">6</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">Safari 3+</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">4</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">4</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">Chrome 3+</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">4</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">4</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">Chrome 11+</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">6</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">？</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">Opera 10+</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">4</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">4</span></td>






</tr>
<tr>
<td style="word-break: break-all;"><span style="font-size: 14px;">Opera 11+</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">16</span></td>
<td style="word-break: break-all;" align="center"><span style="font-size: 14px;">？</span></td>






</tr>






</tbody>






</table>






</div>






</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div><strong><span style="color: #800000; font-size: medium;">附录D：expires和last-modified概念</span></strong></div>
<div>1）Expires</div>






</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div>给出的日期/时间后，被响应认为是过时。如Expires: Thu, 02 Apr 2009 05:14:08 GMT</div>
<div>需和Last-Modified结合使用。用于控制请求文件的有效时间，当请求数据在有效期内时客户端浏览器从缓存请求数据而不是服务器端. 当缓存中数据失效或过期，才决定从服务器更新数据。</div>
<div>2）Last-Modified和Expires</div>
<div>Last-Modified标识能够节省一点带宽，但是还是逃不掉发一个HTTP请求出去，而且要和Expires一起用。而Expires标识却使得浏览器干脆连HTTP请求都不用发，比如当用户F5或者点击Refresh按钮的时候就算对于有Expires的URI，一样也会发一个HTTP请求出去，所以，Last-Modified还是要用的，而 且要和Expires一起用。</div>






</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><hr /></div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">赠图一枚：</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><a href="http://weibo.com/zhenghedao" target="_blank">@正和岛标准</a> ：【看图】做事感觉特别困难的时候，可能收获也会特别巨大。</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div class="artwork"><img id="pic" src="http://ww2.sinaimg.cn/large/873ceaf9jw1e3nuqnezkrj.jpg" alt="" /></div>


&nbsp;</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><a class="WB_name S_func3" title="烈火在线" href="http://weibo.com/2767576517">@烈火在线</a>：每次看产品经理发来的文档，都是这种感觉。。。</div>
<div style="color: #000000; font-family: 微软雅黑; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">
<div class="artwork"><img id="pic" src="http://ww2.sinaimg.cn/large/a4f5ddc5jw1e439m1389mj20dm092q3j.jpg" alt="" /></div>
<div class="artwork">&nbsp;</div>


</div>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2013-05-09 16:20</span>&nbsp;
<a href="https://www.cnblogs.com/zhengyun_ustc/">旁观者</a>&nbsp;
阅读(<span id="post_view_count">...</span>)&nbsp;
评论(<span id="post_comment_count">...</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=3069239" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(3069239);return false;">收藏</a></div>
        </div>
<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 10850, cb_blogApp = 'zhengyun_ustc', cb_blogUserGuid = 'd899310b-63cf-dd11-9e4d-001cf0cd104b';
    var cb_entryId = 3069239, cb_entryCreatedDate = '2013-05-09 16:20', cb_postType = 1; 
    loadViewCount(cb_entryId);
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;">
            <script>
                if (new Date() >= new Date(2018, 9, 13)) {
                    googletag.cmd.push(function () { googletag.display("div-gpt-ad-1539008685004-0"); });
                }
            </script>
        </div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>    </div>
</div>
            </div>
        </div>

        <div id="sideBar">
            <div id="sideBarMain">
                
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

                <div id="calendar"><div id="blog-calendar" style="display:none"></div></div>                
                <script>loadBlogDefaultCalendar();</script>
                <div id="leftcontentcontainer">
                    <!-- begin:SingleColumn -->
                    <div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
                    <!-- end:  SingleColumn -->
                </div>
            </div>
        </div>
        <div class="clear"></div>
    </div>
    <div class="clear"></div>
    <div id="footer">
        <!--done-->
Copyright &copy; 2020 旁观者
<br /><span id="poweredby">Powered by .NET Core on Kubernetes</span>

    </div>
</div>

    
</body>
</html>