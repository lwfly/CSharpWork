<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin" />
    <meta property="og:description" content="前言 工业机械产品大多体积庞大、运输成本高，在参加行业展会或向海外客户销售时，如果没有实物展示，仅凭静态、简单的图片说明书介绍，无法让客户全面了解产品，不仅工作人员制作麻烦，客户看得也费力。如果能在 " />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>基于 HTML5 WebGL  的发动机 3D 可视化系统 - xhload3d - 博客园</title>
    
    <link rel="stylesheet" href="/css/blog-common.min.css?v=Z9Vw4btcgJmrpUEjY_SgebmTmDXJ_hPFoST7ad2aJp4" />
    <link id="MainCss" rel="stylesheet" href="/skins/cogitation/bundle-cogitation.min.css?v=PJ48NAY_dmbjZZ0ZTev3Avl3BcTMJe39d3Pc83CPcig" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/cogitation/bundle-cogitation-mobile.min.css?v=jLHKTG0H_smj72y-Z2j0JGYUmhBVGTu4_QpAGb1B_sA" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/xhload3d/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/xhload3d/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/xhload3d/wlwmanifest.xml" />
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=98Fvfd6UZH20B_MF08daNaODjSu879MVR9RHmyvWAlg"></script>
    <script>
        var currentBlogId = 171723;
        var currentBlogApp = 'xhload3d';
        var cb_enable_mathjax = false;
        var isLogined = false;
        var skinName = 'Cogitation';
    </script>
    
    
    
</head>
<body>
    <a name="top"></a>
    
    <div id="top">
	
<div>
	<table>
		<tr>
			<td class="HeaderTitles">
				<h1 class="HeaderTitle"><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/xhload3d/">xhload3d</a>
</h1>
				<p id="tagline">
www.hightopo.com
</p>
			</td>
		</tr>
	</table>
</div>
<div class="HeaderBar">
	<table id="HeaderBar" class="HeaderBar" cellpadding="0" cellspacing="0">
		<tr>
			<td class="HeaderBarTab" nowrap>
&nbsp;
<a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
 ::

<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/xhload3d/">
首页</a>
 ::
<a href="http://q.cnblogs.com" class="menu">博问</a> ::
<a href="http://home.cnblogs.com/ing/" class="menu">闪存</a> ::


<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
 ::

<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/xhload3d">
联系</a> ::

<a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/xhload3d/rss/">
订阅</a>

<a id="blog_nav_rss_image" href="https://www.cnblogs.com/xhload3d/rss/">
    <img src="/skins/cogitation/images/xml.gif" alt="订阅" />
</a> ::

<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
 ::


</td>
			<td><img id="Header1_BlueTab" src="/skins/cogitation/images/BlueTabRight.gif" align="absmiddle" alt=""/></td>
			<td class="HeaderBarTabBack" nowrap width="100%">
				<div class="BlogStatsBar">
	<table class="BlogStatsBar">
		<tr>
			<td width="100%">
			</td>
			<td class="BlogStatsBar" nowrap>
				&nbsp;
				
236 
				随笔&nbsp;::
				
1 文章
				::
				
429 评论
				::
				
0 引用
			</td>
		</tr>
	</table>
</div>


			</td>
		</tr>
	</table>
</div>


</div>
<div id="leftmenu">	

	    <div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>
		
<div id="sidebar_news" class="newsItem">
            <script>loadBlogNews();</script>
</div>

<div id="sidebar_ad"></div>
		<div id="blog-sidecolumn"></div>
                    <script>loadBlogSideColumn();</script>
	
</div>
<div id="main">
	<div id="post_detail">
<div class="post">
	<div class="postTitle">
		
<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/xhload3d/p/12520693.html">基于 HTML5 WebGL  的发动机 3D 可视化系统</a>

	</div>
	
	<div class="postText">
		
    <div id="cnblogs_post_description" style="display: none">
        <img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200205161952589-658210919.png" class="desc_img">工业机械产品大多体积庞大、运输成本高，在参加行业展会或向海外客户销售时，如果没有实物展示，仅凭静态、简单的图片说明书介绍，无法让客户全面了解产品，不仅工作人员制作麻烦，客户看得也费力。如果能在 Web 上做 3D 设备展示，销售人员可以不限平台随时给客户介绍演示。还可以不受现实条件限制，演示设备拆分和组装的过程，展示产品内部结构和动态运作时的效果，让客户更直观了解产品的部件组成，更准确、全面地了解产品的功能和特点，大大降低了沟通成本。为了解决这些行业痛点，本篇文章采用 Hightopo 的 HT for Web 产品实现了一个发动机设备 3D 可视化案例。
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
    <h2 id="前言">前言</h2>
<p>工业机械产品大多体积庞大、运输成本高，在参加行业展会或向海外客户销售时，如果没有实物展示，仅凭静态、简单的图片说明书介绍，无法让客户全面了解产品，不仅工作人员制作麻烦，客户看得也费力。如果能在 Web 上做 3D 设备展示，销售人员可以不限平台随时给客户介绍演示。还可以不受现实条件限制，演示设备拆分和组装的过程，展示产品内部结构和动态运作时的效果，让客户更直观了解产品的部件组成，更准确、全面地了解产品的功能和特点，大大降低了沟通成本。为了解决这些行业痛点，本篇文章采用 <a href="http://www.hightopo.com/">Hightopo</a> 的 HT for Web 产品实现了一个发动机设备 3D 可视化案例。</p>
<h2 id="系统预览">系统预览</h2>
<p>预览地址：基于 HTML5 WebGL  的发动机 3D 可视化系统（<a href="http://www.hightopo.com/demo/engine/">http://www.hightopo.com/demo/engine/</a>）</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200205161952589-658210919.png" alt=""></p>
<h2 id="场景搭建">场景搭建</h2>
<p>发动机模型是设计师通过 3ds Max 建模，然后导出 obj 与 mtl 文件，在 HT 中解析 obj 与 mtl 文件生成 3D 场景中可用的模型（可参考 obj 手册《<a href="https://www.hightopo.com/guide2/ht/guide/plugin/obj/ht-obj-guide.html#ref_loadbyjson">通过JSON加载</a>》章节），因为各个部件需要单独操作，所以设备模型拆分为多个 obj 文件后导入。</p>
<p>2D 面板部分则是通过 HT 的矢量绘制，我们需要创建 ht.graph.GraphView 和 ht.graph3d.Graph3dView 来呈现 2D 和 3D 的内容。相关代码如下：</p>
<pre><code>var g2d = new ht.graph.GraphView();
var g3d = new ht.graph3d.Graph3dView();
// 将 3D 组件加入到 body 下
g3d.addToDOM();
// 将 2D 组件加入到 3D 组件的根 div 下
g2d.addToDOM(g3d.getView());
</code></pre>
<h2 id="功能实现">功能实现</h2>
<h3 id="设备拆解动画">设备拆解动画</h3>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200205152209644-1047564759.gif" alt=""></p>
<p>当我们点击“展开”按钮时，给各个动画设置不同的延迟，使动画错开执行，以达到更好的视觉效果，让2D图纸和3D场景更好地联动起来。</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200221052437402-84998407.gif" alt=""></p>
<p>如果我们的每个动画都匀速运行，那看起来难免有些单调。于是我给不同动画加上了不同的 Easing 函数，Easing 函数通过定义不同曲线的数据公式方式，来描述每一帧回调时需要改变图形参数属性的幅度，从而达到均匀、先快后慢、先慢后快，甚至先超出起始值和结束值再慢慢恢复的各种动画特效。这里还有个例子可以帮助我们更直观的感受不同 Easing 函数的效果：《<a href="http://www.hightopo.com/guide/guide/plugin/form/examples/example_easing.html">From Easing</a>》。</p>
<p>例如图纸中心的跟随部件拆解旋转放大的圆环，我给它设置了 Easing.backBoth 缓动效果，代码如下：</p>
<pre><code>// 圆环动画
animCenter(data) {
    ht.Default.startAnim({
        duration: 4500,
        // 设置缓动函数
        easing: Easing.backBoth,
        // 延迟一秒执行动画
        delay: 1000,
        action: function (v, t) {
            // 修改图元缩放值
            data.setScale(1 + v * 0.9, 1 + v * 0.9);
            // 修改图元旋转角度
            data.setRotation(Math.PI * v);
        },
    });
}

// 缓动函数
Easing.easeOutStrong = function (t) {
    var BACK_CONST = 1.70158;
    if ((t *= 2) &lt; 1) {
        return .5 * (t * t * (((BACK_CONST *= (1.525)) + 1) * t - BACK_CONST));
    }
    return .5 * ((t -= 2) * t * (((BACK_CONST *= (1.525)) + 1) * t + BACK_CONST) + 2);
};
</code></pre>
<p>设备部件的拆解动画，是通过改变节点的坐标和旋转角度来实现的，代码如下：</p>
<pre><code>// targetP3 为拆解后的坐标，p3为当前坐标
var p3 = node.p3();
var offset = [targetP3[0] - p3[0], targetP3[1] - p3[1], targetP3[2] - p3[2]];

// targetR3 为拆解后的旋转角度，r3为当前旋转角度
var r3 = node.r3();
var offset = [targetR3[0] - r3[0], targetR3[1] - r3[1], targetR3[2] - r3[2]];

// 拆解动画
ht.Default.startAnim({
    duration: 2000,
    // 设置缓动函数
    easing: Easing.easeOutStrong,
    delay: 1000,
    action: function (v, t) {
        // 修改节点坐标
        node.p3(p3[0] + offset[0] * v, p3[1] + offset[1] * v, p3[2] + offset[2] * v);
        // 修改节点旋转角度
        node.r3(r3[0] + offset[0] * v, r3[1] + offset[1] * v, r3[2] + offset[2] * v);
    },
});

// 缓动函数
Easing.easeOutStrong = function (t) {
    return 1 - (--t) * t * t * t;
};
</code></pre>
<p>还有图纸两侧的面板，可以通过设置它的裁剪方向和裁剪比例实现隐藏效果，代码如下：</p>
<pre><code>// 设置图元裁剪方向为从右到左
node.s('clip.direction', 'left');

// 裁剪动画
ht.Default.startAnim({
    duration: 1800,
    easing: Easing.easeOutStrong,
    action: function (v, t) {
        // 修改图元裁剪比例
        node.s('clip.percentage', 1 - v);
    }
});

// 缓动函数
Easing.easeOutStrong = function (t) {
    return 1 - (--t) * t * t * t;
};
</code></pre>
<h3 id="设备内部运作动画">设备内部运作动画</h3>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200205152223059-1337515892.gif" alt=""></p>
<p>接下来我们实现视角变化动画来观察设备不同部件构造，3D 场景中的视角是由 Graph3dView 提供的 center（目标点坐标）和 eye（摄像机坐标）两个参数决定的，所以视角动画只要动态改变这两个参数，这里用了 HT 提供的 moveCamera 方法实现，代码如下：</p>
<pre><code>g3d.moveCamera([-466, 93, -280], [40, -40, -40], {
    duration: 2500,
    easing: function (t) {
        return 1 - (--t) * t * t * t;
    },
});
</code></pre>
<p>设备中一些小的部件吸附在大部件上，会跟随大部件移动旋转。比如这个液压杆，当我们要实现小部件的运动动画时，如果用修改坐标的方式计算起来比较麻烦，所以我们用修改锚点的方式来实现，锚点影响着节点的位置，锚点也是旋转和缩放的中心点。这里通过修改液压杆的 Y 轴锚点实现动画，效果如下：</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200206093704702-2052459593.gif" alt=""></p>
<p>相关代码如下：</p>
<pre><code>ht.Default.startAnim({
        duration: 800,
        action: function (v, t) {
            // 修改节点 Y 轴锚点
            node.setAnchor3d(0.5,v,0.5);
        },
};
</code></pre>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200205152225586-1041941507.gif" alt=""></p>
<p>点击流动按钮后，我们可以看到管道内有液体流动的动画。要实现流动效果，首先我们需要一张二方连续贴图（左右或上下可以无缝衔接的贴图），然后我们再通过代码驱动 UV 向 U 轴的正值方向偏移一个象限，并无限循环这一动作，效果如下：</p>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200221074910737-957874087.gif" alt=""></p>
<p>代码如下：</p>
<pre><code>ht.Default.startAnim({
    duration: 2000,
    action: function (v, t) {
        // 修改贴图uv值
        node.s('shape3d.uv.offset', [v, 0]);
    },
};
</code></pre>
<h3 id="设备复原动画">设备复原动画</h3>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200205152234946-7762164.gif" alt=""></p>
<h3 id="鼠标移入效果">鼠标移入效果</h3>
<p><img src="https://img2018.cnblogs.com/i-beta/1496396/202002/1496396-20200206201211295-2098159884.gif" alt=""></p>
<p>为了能透过外壳清楚的观察到设备内部结构，所以当鼠标悬停在部件上时，我调整了外壳模型透明度并设置模型高亮模式，相关代码如下：</p>
<pre><code>// 设置高亮颜色
ht.Style['highlight.color'] = 'rgba(255,255,255,0.6)';
// 设置当前高亮的模式
g3d.setHighlightMode('mouseover');
// 节点启用高亮效果
data.s('highlight.visible', true);

// 节点设置为可交互
data.s('interactive', true);
// 节点开启交互后，不阻止场景上默认的交互行为
data.s('preventDefaultWhenInteractive', false);

// 监听交互事件
g3d.mi(function (e) {
    // 鼠标移入事件
    if (e.kind === 'onEnter') {
        // 节点开启透明
        data.s('shape3d.transparent', true);
        // 设置节点透明度
        data.s('shape3d.opacity', 0.25);
    }

    // 鼠标移出事件
    if (e.kind === 'onLeave') {
        data.s('shape3d.transparent', false);
    }
});
</code></pre>
<h3 id="场景视角限制">场景视角限制</h3>
<p>最后，我们再对整个场景的视角范围做下限制，代码如下：</p>
<pre><code>// 设置最大角度
ht.Default.graph3dViewMaxPhi = Math.PI / 2;
// 设置最小角度
ht.Default.graph3dViewMinPhi = Math.PI / 4;
</code></pre>
<h2 id="总结">总结</h2>
<p>通过案例我们可以感受到，相较于传统方式，设备的三维展示具有更灵活的表现形式和更直观生动的效果，对于出口型企业，生动的演示动画能让外商更快了解产品的工作原理和优势，还能避免因语言误差而造成误解。而且比起普通的工业动画，Web 上的可视化系统展示内容更丰富、自由度更高，后续需求更改也更为灵活、成本更低。</p>
<p>本文使用的设备模型是设计师虚构的核动力发动机，更注重于模型的展示效果，如果应用于实际产品中，还可以制作更还原实际的设备拆解流程，通过线上的 3D 产品操作演练，对工作人员进行产品组装、拆分、维修培训。有兴趣可以参考我们另一个案例《<a href="https://www.cnblogs.com/htdaydayup/p/12159507.html">基于 HTML5 WebGL + WebVR 的 3D 虚拟现实可视化培训系统</a>》。</p>

</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
    <div id="blog_post_info"></div>
    <div class="clear"></div>
    <div id="post_next_prev"></div>
</div>
	</div>
	
	<div class="postfoot">
		posted on 
<span id="post-date">2020-03-19 00:01</span>&nbsp;
<a href="https://www.cnblogs.com/xhload3d/">xhload3d</a>&nbsp;
阅读(<span id="post_view_count">...</span>)&nbsp;
评论(<span id="post_comment_count">...</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=12520693" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(12520693);return false;">收藏</a>
	</div>
</div>


<script src="https://common.cnblogs.com/highlight/9.12.0/highlight.min.js"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 171723, cb_blogApp = 'xhload3d', cb_blogUserGuid = '99a30dc7-3165-e311-8d02-90b11c0b17d6';
    var cb_entryId = 12520693, cb_entryCreatedDate = '2020-03-19 00:01', cb_postType = 1; 
    loadViewCount(cb_entryId);
    loadSideColumnAd();
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>

<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container"></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"></div>
    <div id="opt_under_post"></div>
    <script async="async" src="https://www.googletagservices.com/tag/js/gpt.js"></script>
    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
    </script>
    <script>
        googletag.cmd.push(function () {
            googletag.defineSlot("/1090369/C1", [300, 250], "div-gpt-ad-1546353474406-0").addService(googletag.pubads());
            googletag.defineSlot("/1090369/C2", [468, 60], "div-gpt-ad-1539008685004-0").addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
    </div>
    <div id="under_post_news"></div>
    <div id="cnblogs_c2" class="c_ad_block">
        <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;">
            <script>
                if (new Date() >= new Date(2018, 9, 13)) {
                    googletag.cmd.push(function () { googletag.display("div-gpt-ad-1539008685004-0"); });
                }
            </script>
        </div>
    </div>
    <div id="under_post_kb"></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div></div>


</div>
<div class="footer">
<p id="footer">
	Powered by: 
	<br />
	
	
<a href="https://www.cnblogs.com/" id="Footer1_Hyperlink3" style="font-size: 12px; font-family: Verdana">博客园</a>
	<br />
	Copyright &copy; 2020 xhload3d
<br /><span id="poweredby">Powered by .NET Core on Kubernetes</span>

</p>


</div>


    
</body>
</html>